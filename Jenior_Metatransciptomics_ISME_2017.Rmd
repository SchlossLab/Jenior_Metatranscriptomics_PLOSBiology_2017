---
title: "*Clostridium difficile* changes murine gut communities"
csl: isme.csl
output:
 word_document:
  keep_md: true
  reference_docx: manuscript_format.docx
bibliography: references.bib
---

**Authors:** Matthew L. Jenior, Jhansi L. Leslie, and Patrick D. Schloss^\*^


```{r startup, echo=F, message=F, warning=F, cache=F}

# Load dependencies
deps <- c('shape', 'vegan', 'klaR', 'igraph', 'matrixStats', 'flux', 'knitr','plyr')
for (dep in deps){
 if (dep %in% installed.packages()[,"Package"] == FALSE){
  install.packages(as.character(dep), quiet=TRUE);
 }
 library(dep, verbose=FALSE, character.only=TRUE)
}

# Define function for formatting growth curves for statistical analysis
format_curve <- function(raw_exp_data, exp_group, raw_control_data){
 formatted_data <- c()
 control_data <- c()
 for (time in 1:nrow(raw_exp_data)){
  temp_exp <- cbind(exp_group, time, raw_exp_data[time,])
  formatted_data <- rbind(formatted_data, temp_exp)
  temp_control <- cbind('control', time, raw_control_data[time,])
  control_data <- rbind(control_data, temp_control)
 }
 formatted_data <- as.data.frame(rbind(control_data, formatted_data))
 colnames(formatted_data) <- c('substrate','time','od')
 formatted_data$od <- as.numeric(as.character(formatted_data$od))

 return(formatted_data)
}

# Mouse metadata
metadata <- read.delim('data/metadata.tsv', sep='\t', header=T, row.names=1)
# Figure 1 data
cfu <- read.delim('data/wetlab_assays/cfu.dat', sep='\t', header=T)
toxin <- read.delim('data/wetlab_assays/toxin_titer.dat', sep='\t', header=T)
# Table 1 contents
table_1 <- read.delim('data/table_1.tsv', sep='\t', header=TRUE)
table_1 <- as.data.frame(lapply(table_1, function(x) {gsub('_', ' ', x)}))

```


###Abstract



###Introduction



###Results


```{r table_1, echo=F, warning=F, message=F, cache=F}

dust(table_1) %>%
  sprinkle(font_size=8,
           font_size_units='pt') %>% 
  sprinkle_print_method('markdown')

```


***C. difficile* differentially expresses virulence factors across separate classes of antibiotic pretreatment.**
Prior to oral *C. difficile* str. 630 spore challenge, conventionally-reared SPF mice were pretreated with one of three different antibiotics to sensitize the animals to *C. difficile* colonization. The selected antibiotics were streptomycin, cefoperazone, and clindamycin (Table 1). Each drug was chosen not only due to its ability to reduce *C. difficile* colonization resistance in a mouse model [@Schubert2015], but also for their distinct and significant impacts on the structure and diversity of the cecal microbiome (all *p* < 0.001; Fig. S1a & Table S1). Selection of this toxigenic *C. difficile* strain was based on its moderate clinical severity in mouse models [@], previous studies of *in vitro* metabolism [@], and well-annotated genome [@]. Briefly, mice were pretreated with the respective antibiotic as indicated in Fig. 1a and were subsequently orally gavaged ~1×10^3^ *C. difficile* str. 630 spores before necropsy at 18-hours post-infection. This end point corresponded with a previous study where another laboratory strain of *C. difficile* reached maximum cecal vegetative cell density with few detectable spores [@]. 

At this final time-point, we first quantified vegetative *C. difficile* colony forming units (cfu) per gram of cecal content (Fig. 1b). There was no significant difference in the number of vegetative cells between any antibiotic-pretreatment tested and all susceptible mice were colonized to ~1×10^8^ vegetative cfu per gram of cecal content, while untreated mice maintained *C. difficile* colonization resistance. We moved on to measure both sporulation and toxin activity as activation of both processes has been linked to environmental concentrations of specific growth nutrients [@]. Despite having the similar amounts of vegetative *C. difficile* cells, varying levels of both spore cfu and toxin titer were found across each of the antibiotic pretreatment models tested. These results showed that *C. difficile* colonized different antibiotic-pretreated mice to consistently high levels, and the distinct treatments corresponded with moderate differences in the expression of *C. difficile* virulence factors.


***C. difficile* colonization differentially corresponded with structural differences in the cecal bacterial community between antibiotic pretreatments.**
In order to evaluate changes in bacterial population abundances in response to perturbation and *C. difficile* colonization, we performed 16S rRNA gene V4 region sequencing from cecal content of both mock and *C. difficile*-infected mice across antibiotic pretreatment models. To focus analysis specifically on the surrounding bacterial communities, we removed all sequences contributed by *C. difficile* prior to downstream analysis. Following data curation, we first reconfirmed that each antibiotic treatment significantly impacted both cecal community structure (ThetYC distances) and diversity (inverse-Simpson) compared to untreated control mice (all *p* < 0.001, Fig. S1a & S1b). We then ensured that each antibiotic class induced disntict shifts in community which significantly differed from one another (all *p* < 0.001, Fig. S1c). The composition of streptomycin-pretreated communities was more variable between cages, but was generally enriched for members of phylum Bacteroidetes (Fig. 1c). Cefoperazone and clindamycin-pretreated cecal were consistently dominated by the families Lactobacillaceae and Enterobacteriaceae respectively (Fig. 1c). 

Next, we measured the effect that *C. difficile* colonization had on overall community structure and composition for each of the antibiotic groups. We found that structure both streptomycin and clidamycin-pretreated communities were significantly different from their within-group uninfected controls (*p* = 0.014, Fig. S1d; *p* = 0.003, Fig. S1f).
Infected cefoperazone-pretreated communities did not significantly differ from their control group (Fig. S1e). We then sought to identify specific OTUs that significantly differed in abundance between mock and *C. difficile* infection within each pretreatment group. To accomplish this, we utilized LEfSe differential abundant feature detection [@Segata2011] for each perturbed cecal community comparing mock and *C. difficile*-infected conditions. In order to improve the ability to distinguish between potentially informative OTUs and differences that arise from cage effects, we screened for OTUs that appear in at least nine samples for each antibiotic pretreatment separately (n=9 mice per experimental group). This analysis revealed a total of 16 OTUs that discriminated between infected and uninfected communities in at least one antibiotic pretreatment (Fig. 1d-1f). The most frequent differences were seen in the abundance of OTUs at very low relative abundance. In these instances, these OTUs were generally only detectable in either mock of *C. difficile*-infected states. The type of change associated with infection was also not constant in that some OTUs would increase in relative abundance following *C. difficile* colonization while others instead decreased. Additionally, we performed a corrected Wilcoxon rank-sum test for the relative abundance of each discriminating OTU across pretreatments to assess for consistent changes in abundance. In streptomycin pretreatment, only *Porphyromonadaceae* (OTU5) was significantly increased during infection while *Turicibacter* (OTU6) was significantly decreased (*p* < 0.05, Fig. 1d). Cefoperzone-pretreatment was associated with significant inceases in both *Faecalibacterium* (OTU49) and *Arthrobacter* (OTU17) with a decrease in *Lactobacillus* (OTU1) during infection. Finally, the only significantly different OTU in clindamycin pretreatment was *Lactobacillus* (OTU1) which increased with infection. Interstingly, not only was *Lactobacillus* (OTU1) the only OTU which discriminated infection groups within multiple antibiotic pretreatments (cefoperazone & clindamycin), but its relatively abundance significantly increased in both. These results indicated that certain taxonomic groups may be more prominently effected by *C. difficile* colonization than others and implies possible direct or indirect interactions.

***C. difficile* colonization corresponds with shifts in the expression of several metabolic pathways and nutrient acquisition systems accross the cecal microbiome**
Following the changes in abundance of specific bacterial taxa during *C. difficile* colonization we became interested in examining if not only structure of the microbiome was altered, but also the active functionality. In order the most closely analyze which bacterial groups differentially responded to infection, we employed a metagenomic-enabled metatranscriptomic shotgun sequencing approach with paired DNA and RNA samples collected from the cecal content of the mice used in the previous analyses. Metagenomic reads from mock-infected cecal communities were respectively assembled into contigs and putative genes were identified resulting in 234,124 (streptomycin), 83,096 (cefoperazone), and 35,977 (clindamycin) potential genes in each metagenome. Streptomycin pretreatment resulted in a significantly more diverse community (Fig. S1a) than other groups, so a larger detectable metagenome was expected. Putative genes were then annotated according to KEGG and the subset of genes the were successfully annotated with function were utilized for the next analysis; 15.51% (streptomycin), 19.47% (cefoperazone), and 34.78% (clindamycin). Despite utilizing only mock-infected metagenomes for assembly, we still removed genes in which the top alignment was to *C. difficile* prior to read mapping. This was done to avoid skewed results between uninfected and infected metatranscriptomes where *C. difficile* was present to contribute to the transcript pool. Quality-trimmed DNA and cDNA reads from both infected and uninfected conditions were then mapped to the gene catalog that corresponded to their antibiotic pretreatment group of origin. The resulting abundances were normalized to both sequencing read length and target gene length to yeild a per base mapping abundance. Finally, after equal subsampling, metatranscriptomic read abundances for each gene were divided by their corresponding metagenomic coverage in order to normalize for overrepresented genes and species. Therefore, final expression values represent the level of expression upregulation for each gene outside of those from which transcript is abundant but is only expressed at low levels from genes which are highly abundant.

Utilizing the fully normalized metatranscriptomes, we first focused on expressional differences in broadly defined pathways and gene catagories for each antibiotic pretreatment with and without *C. difficile*-infection. To observe these differences we quantified expression of all genes in each community that were annotated as part of a given pathway, regardless of taxonomic information. We then calculated the difference in cDNA abundance for each pathway between infected and uninfected conditions, represented as delta-cDNA abundance. To highlight the largest dfferences, we limited the analysis to the top 5 KEGG pathways with the most change between mock and *C. difficile*-infected conditions within each pretreatment (Fig. 2a). Average expression was nearly identical in either experimental or control, which demonstrated that similar levels of overall transcription was occuring in either state in spite of the large differences shown. In streptomycin and clindamycin pretreatments, greater expression of KEGG pathways was observed in the *C. difficile*-infected metatranscriptomes. Both groups displayed large changes in amino sugar metabolism and ABC transporters, however other distinct carbon metabolism pathways were upregulated in each. Glycolysis and oxidative phosphorylation are overrepresented in streptomycin pretreatment while starch/sucorse metabolism and PTS systems were more abundant associated with clindamycin. Together these shifts suggest that these communities differentially adapt carbon metabolism pathways in reponse to colonization of the invasive species *C. difficile*. Conversely, the largest differences seen in cefoperazone treatment were more greatly expressed in the absence of *C. difficile* infection. None of these pathways were shared with the other conditions and included three separate pathways for the replication or manipulation of genetic material (RNA processing, tRNA sythesis, & homologous recombination). As these processes are strongly connected to cell division [@.....], these results could indicate a shift away from increasing biomass toward metabolizing simple carbohydrates (Table S3) which could be the result of competition with *C.difficile* for otherwise uncontested resources. We then moved on to perform a more fine-scale analysis of changes at the individual gene annotation level selecting the genes in each antibiotic pretreatment group with the largest disparity in normalized cDNA abundance between mock and *C. difficile*-infected groups (Fig. 2b-2d). In agreement with pathway-level differences in expression, the majority genes with large degrees of difference were members of multiple pathways highlighted in Fig. 2a. A trend appeared in the amount of difference for top-ranking genes in cefoperazone-pretreated communities, as it was much larger than that of the other treatment goups which suggested a greater overall effect of *C. difficile* on transcription of the microbiota under these conditions. It important to note that these groups are equally subsampled, implying that more genes are evenly expressed at lower levels in mock infection instead of a small number of genes highly upregulated. These data expand on our interpretation of pathway-level analysis in that *C. difficile* colonization leads to changes in community-level expression of genes for acquisition and catabolism. Our results also raised questions about which taxonomic groups underscore the differences seen and are potentially more impacted by *C. difficile* colonization than others.


***C. difficile* colonization correlates with large-scale changes in expression of different bacterial taxa between perturbed cecal environments**
In light of large-scale differences in expression across the microbiota concomitant with *C. difficile* colonization, we desired to identify those bacterial groups responsible for the shift in each pretreatment condition. To accomplish this we utilized the genus level taxonomic information associated with each KEGG annotation to identify which group likely contributed a given gene to the metagenome. Many genes in the KEGG database are annotated as hypothetical or uncharacterized but still possess a taxonomic annotation. This resulted in substantially more genes from the total  being conserved for analysis in each group; 19.15% (streptomycin), 25.1% (cefoperazone), and 44.45% (clindamycin). With these data, we narrowed the focus onto transcription for genera that represented >0.01% of genes receiving taxonomic annotations in any of the three metagenomic assemblies. We then directly compared the normalized cDNA abundances for each gene between infected & uninfected states for each antibiotic pretreatment and colored points based on genus classifications (Fig. 3a-3c). Coordinates were determined by the relative expression of each gene in mock and *C. difficile* infection for x and y axes respectively. This causes genes with equal transcription in both conditions being compared to be strongly correlated and positioned proximal to the central diagonal line. As such, we then applied linear correlation and a squared residual cutoff to define those genes that are most strongly upregulated in either condition.

These data revealed distinct changes in expression for underrepresented genera for each antibiotic pretreatment between infections conditions. First, in streptomycin-pretreated mice, the most prominent differences were in 937 genes belonging to *Lactobacillus* were upregulated in *C. difficile* infection (Fig. 3a). Next, in cefoperazone pretreatment 2290 genes belonging to *Bacteroides* were more upregulated in mock infection (Fig. 3b). A consistent trend in streptomycin and cefoperazone pretreatments was an overrepresentation of expression from genera belonging to Bacteroidetes during mock infection. The metatransciptomes for both of these pretreatment poorly correlated with one another, indicating a high degree of change induced by *C. difficile* colonization (*r* = 0.0334 & *r* = 0.031). Finally, in clindamycin pretreatment the largest difference in transcription was for 510 *Lactobacillus* genes during *C. difficile* infection (Fig. 3c). Infected and uninfected metatranscriptomes associated with this antibiotic correlated the more strongly than either other pretreatment (*r* = 0.862), supporting that *C. difficile* colonization had a low impact on transcription of the cecal microbiota. This infection model has been shown to go on to clear *C. difficile* infection witin 7 days, as opposed to long-term colonization, which suggests that communities where *C. difficile* is less able to impact resident members' activity regain colonization resistance more quickly (Fig. S5....). Interestingly, taxonomic groups most highly represented as outliers in the normalized metatranscriptomes of all tested antibiotic pretretreatments were actually minority members of the respective cecal communities as determined 16S rRNA gene abundance (Fig. 1c). As a side note, the presence of Archeael sequences in our shotgun sequencing data was not surprising as the universal 16S rRNA gene V4 region primers we used do not reliably amplify Archeae. Together, our metatranscriptomic results support that *C. difficile* may differentially modify the transcriptional activity of separate microbial taxa based on the context of the community in which it is colonizing. 

**Modeling competition for nutrients across the microbiome**

in order to more closely tie taxonomic groups to gene function and overexpression, we did this modeling bullshit...

To more clearly integrate community-level transcriptomic data, we chose to leverage methods for genome-scale metabolic modeling previously described by our group [@Jenior2017]. To generate annotated genomes for discrete bacterial taxa on which to map transcriptomic reads, we implemented clustering of our assembled contigs based on abundance and composition [CONCOCT reference]. Strongly clustered groups of sequences were treated as individual species and a separate metabolic model with metabolite importance scores were calculated for each (Fig. S____ CONCOCT clusters in supplement for this section). Within each community, we then compared pair-wise ratios of metabolite importance scores for each possible interspecies interaction utilizing evenly rarified transcriptomic abundances between the models (Fig. 4A). This provided a metric that reflected the level of competition for a given metabolite existed between particular pairs of bacterial taxa. We then went on to perform cumulative calculation of importance for each metabolite across all species in a given community (Fig. 4B). Values from this analysis give and estimation of the most highly sought after metabolites in the communities tested. Combined, this approach allowed for predicition of nutrient niche segregation between species in the cecal bacterial community and how *C. difficile* altered this landscape to establish its own metabolic strategy.


Add panels to fig 4 about individual species importances and high demand metabolites.
 - paragraph discussing these results here


```{r figure_5, echo=F, warning=F, message=F, results='hide', cache=F}

# Metabolomic data
metabolome <- read.delim('data/wetlab_assays/metabolomics.tsv', sep='\t', header=T)
annotation <- metabolome[,1:5]
metabolome$SUPER_PATHWAY <- NULL
metabolome$SUB_PATHWAY <- NULL
metabolome$PUBCHEM <- NULL
metabolome <- subset(metabolome, KEGG != 'NA')
metabolome <- metabolome[match(unique(metabolome$KEGG), metabolome$KEGG),]
rownames(metabolome) <- metabolome$KEGG
metabolome$KEGG <- NULL
metabolome$BIOCHEMICAL <- NULL
annotation <- subset(annotation, KEGG != 'NA')
annotation <- annotation[match(unique(annotation$KEGG), annotation$KEGG),]
rownames(annotation) <- annotation$KEGG
annotation$KEGG <- NULL
annotation$SUB_PATHWAY <- NULL
annotation$PUBCHEM <- NULL
annotation$BIOCHEMICAL <- NULL
annotation$SUPER_PATHWAY <- gsub('_',' ', annotation$SUPER_PATHWAY)

# Combine with metadata
metadata <- read.delim('data/metadata.tsv', sep='\t', header=T, row.names=1)
metabolome <- merge(t(metabolome), metadata, by='row.names')
rm(metadata)
rownames(metabolome) <- metabolome$Row.names
metabolome$Row.names <- NULL
metabolome <- subset(metabolome, abx != 'none')
metabolome_630 <- subset(metabolome, infection == '630')
metabolome_630$cage <- NULL
metabolome_630$mouse <- NULL
metabolome_630$gender <- NULL
metabolome_630$type <- NULL
metabolome_630$infection <- NULL
metabolome_630 <- aggregate(metabolome_630[, 1:399], list(metabolome_630$abx), median)
rownames(metabolome_630) <- metabolome_630$Group.1
metabolome_630$Group.1 <- NULL
metabolome_630 <- as.data.frame(t(metabolome_630))
colnames(metabolome_630) <- c('cef_630','clinda_630','gf_630','strep_630')
metabolome_mock <- subset(metabolome, infection == 'mock')
metabolome_mock$cage <- NULL
metabolome_mock$mouse <- NULL
metabolome_mock$gender <- NULL
metabolome_mock$type <- NULL
metabolome_mock$infection <- NULL
metabolome_mock <- aggregate(metabolome_mock[, 1:399], list(metabolome_mock$abx), median)
rownames(metabolome_mock) <- metabolome_mock$Group.1
metabolome_mock$Group.1 <- NULL
metabolome_mock <- as.data.frame(t(metabolome_mock))
colnames(metabolome_mock) <- c('cef_mock','clinda_mock','gf_mock','strep_mock')

# Calculate ratio of mock to infected concentrations
metabolome_mock <- 10 ^ metabolome_mock
metabolome_630 <- 10 ^ metabolome_630
metabolome <- metabolome_mock / metabolome_630
metabolome <- log10(metabolome)
metabolome <- merge(metabolome, annotation, by='row.names')
rownames(metabolome) <- metabolome$Row.names
metabolome$Row.names <- NULL
colnames(metabolome) <- c('cefoperazone_conc', 'clindamycin_conc', 'streptomycin_conc', 'pathway')
rm(annotation, metabolome_mock, metabolome_630)

# Merge importances to one table
cef_importances <- read.delim('data/metabolic_models/cefoperazone_630.bipartite.files/importances.tsv', sep='\t', header=T, row.names=1)
cef_importances$p_value <- NULL
clinda_importances <- read.delim('data/metabolic_models/clindamycin_630.bipartite.files/importances.tsv', sep='\t', header=T, row.names=1)
clinda_importances$p_value <- NULL
clinda_importances$Compound_name <- NULL
strep_importances <- read.delim('data/metabolic_models/streptomycin_630.bipartite.files/importances.tsv', sep='\t', header=T, row.names=1)
strep_importances$p_value <- NULL
strep_importances$Compound_name <- NULL
importances <- merge(cef_importances, clinda_importances, by='row.names')
rownames(importances) <- importances$Row.names
importances$Row.names <- NULL
importances <- merge(importances, strep_importances, by='row.names')
rownames(importances) <- importances$Row.names
importances$Row.names <- NULL
colnames(importances) <- c('Compound_name', 'cefoperazone_score', 'clindamycin_score', 'streptomycin_score')
importances$Compound_name <- gsub('_',' ', importances$Compound_name)
rm(cef_importances, clinda_importances, strep_importances, gf_importances)

# Merge metabolome medians and importance values
combined <- merge(importances, metabolome, by='row.names')
rownames(combined) <- combined$Row.names
combined$Row.names <- NULL
rm(importances, metabolome)

# Separate treatment groups
cef <- as.data.frame(cbind(combined$cefoperazone_score, combined$cefoperazone_conc, combined$pathway))
rownames(cef) <- rownames(combined)
colnames(cef) <- c('score', 'conc', 'pathway')
cef$name <- combined$Compound_name
cef$score <- as.numeric(as.vector(cef$score))
cef$conc <- as.numeric(as.vector(cef$conc))
cef <- subset(cef, cef[,1] != 0) # remove metabolites with 0 importance
clinda <- as.data.frame(cbind(combined$clindamycin_score, combined$clindamycin_conc, combined$pathway))
rownames(clinda) <- rownames(combined)
colnames(clinda) <- c('score', 'conc', 'pathway')
clinda$name <- combined$Compound_name
clinda$score <- as.numeric(as.vector(clinda$score))
clinda$conc <- as.numeric(as.vector(clinda$conc))
clinda <- subset(clinda, clinda[,1] != 0) # remove metabolites with 0 importance
strep <- as.data.frame(cbind(combined$streptomycin_score, combined$streptomycin_conc, combined$pathway))
rownames(strep) <- rownames(combined)
colnames(strep) <- c('score', 'conc', 'pathway')
strep$name <- combined$Compound_name
strep$score <- as.numeric(as.vector(strep$score))
strep$conc <- as.numeric(as.vector(strep$conc))
strep <- subset(strep, strep[,1] != 0) # remove metabolites with 0 importance
combined <- rbind(strep, cef, clinda)

# Fit to general linear models and identify outliers (L1 regression)
strep_fit <- glm(conc ~ score, data=strep)
strep$residuals <- residuals(strep_fit)
strep$residuals <- (strep$residuals / sd(strep$residuals))^2
strep_outliers <- strep[strep$residuals > 1.5, ]
cef_fit <- glm(conc ~ score, data=cef)
cef$residuals <- residuals(cef_fit)
cef$residuals <- (cef$residuals / sd(cef$residuals))^2
cef_outliers <- cef[cef$residuals > 1.5, ]
clinda_fit <- glm(conc ~ score, data=clinda)
clinda$residuals <- residuals(clinda_fit)
clinda$residuals <- (clinda$residuals / sd(clinda$residuals))^2
clinda_outliers <- clinda[clinda$residuals > 1.5, ]
combined_fit <- glm(conc ~ score, data=combined)
combined$residuals <- residuals(combined_fit)
combined$residuals <- (combined$residuals / sd(combined$residuals))^2
combined_outliers <- combined[combined$residuals > 1.5, ]

# Calculate stats
corr_m <- round(c(strep_fit$coefficients[[2]],cef_fit$coefficients[[2]],clinda_fit$coefficients[[2]],combined_fit$coefficients[[2]]), digits=3)
corr_m_strep <- corr_m[1]
corr_m_cef <- corr_m[2]
corr_m_clinda <- corr_m[3]
corr_m_combined <- corr_m[5]

corr_r <- round(c(cor.test(strep[,1], strep[,2], method='spearman', exact=FALSE)$estimate,
        cor.test(cef[,1], cef[,2], method='spearman', exact=FALSE)$estimate,
        cor.test(clinda[,1], clinda[,2], method='spearman', exact=FALSE)$estimate,
        cor.test(combined[,1], combined[,2], method='spearman', exact=FALSE)$estimate), digits=3)
corr_r_strep <- corr_r[1]
corr_r_cef <- corr_r[2]
corr_r_clinda <- corr_r[3]
corr_r_combined <- corr_r[5]

corr_p <- round(c(cor.test(strep[,1], strep[,2], method='spearman', exact=FALSE)$p.value,
        cor.test(cef[,1], cef[,2], method='spearman', exact=FALSE)$p.value,
        cor.test(clinda[,1], clinda[,2], method='spearman', exact=FALSE)$p.value,
        cor.test(combined[,1], combined[,2], method='spearman', exact=FALSE)$p.value), digits=3)
corr_p_strep <- corr_p[1]
corr_p_cef <- corr_p[2]
corr_p_clinda <- corr_p[3]
corr_p_combined <- corr_p[5]

```

**Modeling competition for nutrients between discreet taxanomic groups in the metagenome.**


In previous work from Jenior et. al. (2017), the authors established a simple computational framework to impute those metabolites which a bacterium is most likely to obtain from its environment based transcriptome-informed genome-enabled metabolic models. In the current study, we have extended these methods to analyze the putative competition for nutrients between bacteria in the perturbed cecal microbiota. This approach is especially informative when assessing which groups are most competitive with *C. difficile* for growth nutrients and may prevent its colonization in healthy communities. In this new method, the level of possible competition for a substrate is imputed based on the transcription of enzymes that utilize it within a pair of organisms, then this process is repeated iteratively for all shared metabolites between the pair. For each comparison, the absolute value of the difference between the inverse-log~2~ of metabolite importance scores for a given metabolite shared between the metabolic models is calculated. This value is then re-transformed for comparability and ultimately reflects the magnitude in which the organisms of interest compete for a pool of metabolites. These calculations are then extended to each possible pairing of taxa in the provided community in an effort to determine those metabolites that are highly sought after as well as identifying potentially vacant nutrient niches that *C. difficile* could exploit following infection.



**Community-level metabolic network results are predictive of cecal metabolite concentrations**

More effective way to integrate metatranscriptome with metabolome - unified global correlation of gene expression and change in metabolite concentrations neglects the activity of individual species


Old text from previous paper:
Moving beyond specific metabolite analysis, we wanted to determine how well metabolite importance scores related to the relative concentration of all metabolites in a given environment. To most effectively combine metabolite importance scores with the affiliated concentration data, we decided to calculate the median change in relative concentration for each metabolite measured between corresponding mock and *C. difficile*-infected conditions. This was accomplished by dividing the median log10-scaled intensity of each metabolite in mock-infected mice by its corresponding intensity in *C. difficile*-infected mice to give the delta median scaled intensity for each metabolite. In this way, larger values indicated those metabolites that decreased in concentration when *C. difficile* colonized. This also resulted in a single value we could combine with importance scores for each metabolite and perform a linear correlation analysis. Positive correlations indicated that the metabolites predicted to be consumed by *C. difficile* through transcript-informed metabolic networks have a concomitant decrease in the metabolome. This relationship would also imply that those metabolites with negative importance scores and increased concentration in infected animals are being produced by *C. difficile*. 

We applied this approach first to a pooled analysis of all groups to maximize our ability to validate the predictive capacity of the modeling algorithm (Fig. 6A). This revealed a significant positive correlation (*P* = `r corr_p_combined`) and supported our method for identifying metabolites that are most likely to be consumed by *C. difficile* based on transcriptional activity. This technique also allowed us to analyze outliers from the generalized linear model to assess if they are explained by other known patterns of *C. difficile* biology. Applying least-squared residuals analysis, we found that 16 metabolites were determined to be outliers and were all classified 1 of 3 separate KEGG annotation categories; amino acids, carbohydrates, and nucleotides (Table S5). We went on to identify the majority subset of 12 outlier metabolites that were important and significantly decreased in their respective condition were annotated as growth substrates or growth enhancers of *C. difficile* [@Karasawa1995]. This included L-proline, L-threonine, N-acetyl-D-glucosamine, D-fructose, and galactitol. These results were interpretted as not a failure of our importance algortihm, but as a possible underestimation of enzyme efficiency for the consumption these metabolites which further supports our approach as a way to determine real *in vivo* metabolic strategies for *C. difficile*. We also explored those metabolites that were more likely to be produced based on importance scores but decreased during infection. These were the nucleotides adenine, deoxyadenosine, and xanthine. *C. difficile* has been shown to possess the capacity for their synthesis [@Karlsson2008], but also may have the ability to catabolize these purines to participate downstream in Stickland reactions [@Hartwich2012]. The findings here may indicate that *C. difficile* utilizes both environmental and synthesized pools of the molecules at a faster rate than they are produced by the bacterium alone and may reinforce the centrality of amino acid fermentation to *C. difficile* *in vivo* metabolism.

We then directed the analysis toward each individual infection condition tested. In streptomycin-pretreatment (Fig. 6B) and cefoperazone-pretreatment (Fig. 6C) the correlations did not achieve significance (*P* = `r corr_p_strep` & `r corr_p_cef`), but remained positive. Analysis of outliers revealed that in streptomycin-pretreatment both the host-derived aminoglycan N-acetyl-D-glucosamine and L-proline were implicated as most likely to be utilized by *C. difficile* while L-proline was the only growth substrate outlier in this way in cefoperazone-pretreated mice. Both clindamycin-pretreatment (Fig. 6D) and ex-GF mice (Fig. 6E) instead demonstrated a significant correlation between importance scores and delta median scaled intensity (*P* = `r corr_p_clinda` & `r corr_p_gf`). Although clindamycin-pretreatment was associated with most outlier metabolites, both groups also shared a similar trend of carbohydrates and Stickland fermentation substrates being important and decreased in infected conditions. Proline specifically was found to be both highly important and decreased in concentration across all infections. In combination with the previously mentioned patterns, this further supports Stickland fermentation as a core metabolic strategy of *C. difficile* in the gut which agrees with previous *in vitro* findings [@Jackson2006]. Together, these data supported network-derived importance scores as well as our hypothesis that *C. difficile* adapted portions of its carbon source metabolism in distinct susceptible environments in addition to certain highly consistent strategies.



changes in metabolome not due to antibiotic treatment alone, c diff colonization correlates with many changes as well



###Discussion








###Materials and Methods

**Animal care and antibiotic administration** For a more detailed description of the procedure, refer to Jenior et al. (2017) [@Jenior2017]. In short, conventionally-reared six-to-eight week-old C57BL/6 mice were administered one of three antibiotics; cefoperazone, streptomycin, or clindamycin (As described in Table S1) before oral *C. difficile* infection. All animal protocols were approved by the University Committee on Use and Care of Animals at the University of Michigan and carried out in accordance with the approved guidelines.

***C. difficile* infection and necropsy.** For a more detailed description of the procedure, refer to Jenior et al. (2017) [@Jenior2017]. On the day of challenge, 1×10^3^ *C. difficile* spores were administered to mice via oral gavage in phosphate-buffered saline (PBS) vehicle. Mock-infected animals were given an oral gavage of 100 μl PBS at the same time as those mice administered *C. difficile* spores. 18 hours following infection, mice were euthanized and necropsied to obtain the cecal contents. Aliquots were immediately flash frozen for later DNA extraction and toxin titer analysis. A third aliquot was transferred to an anaerobic chamber for quantification of *C. difficile* abundance. The remaining content in the ceca was mixed in a stainless steel mortar housed in a dry ice and ethanol bath. Cecal contents from all mice within each treatment group were pooled into the mortar prior to grinding to a fine powder. The ground content was then stored at -80° C for subsequent RNA extraction.

***C. difficile* cultivation and quantification** For a more detailed description of the procedure, refer to Jenior et al. (2017) [@Jenior2017]. Cecal samples were weighed and serially diluted under anaerobic conditions with anaerobic PBS. Differential plating was performed to quantify both *C. difficile* spores and vegetative cells by plating diluted samples on CCFAE plates (fructose agar plus cycloserine, cefoxitin, and erythromycin) at 37° C for 24 hours under anaerobic conditions [@Wilson1982]. In parallel, undiluted samples were heated at 60° C for 30 minutes to eliminate vegetative cells and leave only spores [@Sorg2010]. These samples were serially diluted under anaerobic conditions in anaerobic PBS and plated on CCFAE with taurocholate at 37° C for 24 hours. Plating was simultaneously done for heated samples on CCFAE to ensure all vegetative cells had been eliminated.

***C. difficile* toxin titer assay** To quantify the titer of toxin in the cecum a Vero cell rounding assay was performed as in [@Leslie2015] and [@Jenior2017]. Briefly, filtered-sterilized cecal content was serially diluted in PBS and added to Vero cells in a 96-well plate. Plates were viewed after 24 hour incubation for cell rounding.

**DNA/RNA extraction and sequencing library preparation** DNA for downstream shotgun metagenomic and 16S rRNA gene sequencing was extracted from approximately 50 mg of cecal content from each mouse using the PowerSoil-htp 96 Well Soil DNA isolation kit (MO BIO Laboratories) and an epMotion 5075 automated pipetting system (Eppendorf). The V4 region of the bacterial 16S rRNA gene was amplified using custom barcoded primers and sequenced as described previously using an Illumina MiSeq sequencer [@Kozich2013]. Also described in [@Kozich2013], ~2.5 ng of DNA was used to generate shotgun libraries with a modified 10-cycle Nextera XT genomic library construction protocol (Illumina). 



length of the fragments were assessed using an Agilent BioAnalyzer. Completed libraries were pooled in equal molar quantities within their respective types.




A more detailed description of RNA extraction procedure can be found in [@Jenior2017]. Briefly, immediately before RNA extraction, 3 ml of lysis buffer (2% SDS, 16 mM EDTA and 200 mM NaCl) contained in a 50 ml polypropylene conical tube was heated for 5 minutes in a boiling water bath [@Lopez-Medina2011]. The hot lysis buffer was added to the frozen and ground cecal content. The mixture was boiled with periodic vortexing for another 5 minutes. After boiling, an equal volume of 37° C acid phenol/chloroform was added to the cecal content lysate and incubated at 37° C for 10 minutes with periodic vortexing. The mixture was the centrifuged at 2,500 x g at 4° C for 15 minutes. The aqueous phase was then transferred to a sterile tube and an equal volume of acid phenol/chloroform was added. This mixture was vortexed and centrifuged at 2,500 x g at 4° for 5 minutes. The process was repeated until aqueous phase was clear. The last extraction was performed with chloroform/isoamyl alcohol to remove acid phenol. An equal volume of isopropanol was added and the extracted nucleic acid was incubated overnight at -20° C. The following day the sample was centrifuged at 12000 x g at 4° C for 45 minutes. The pellet was washed with 0° C 100% ethanol and resuspended in 200 μl of RNase-free water. Following the manufacturer's protocol, samples were then treated with 2 μl of Turbo DNase for 30 minutes at 37° C. RNA samples were retrieved using the Zymo Quick-RNA MiniPrep according the manufacturer's protocol. The Ribo-Zero Gold rly, immediately before RNA extraction, 3 ml of lysis buffer (2% SDS, 16 mM EDTA and 200 mM NaCl) contained in a 50 ml polypropylene conical tube was heated for 5 minRNA Removal Kit Epidemiology was then used to deplete prokaryotic and eukaryotic rRNA from the samples according the manufacturer's protocol. Stranded RNA-Seq libraries were made constructed with the TruSeq Total RNA Library Preparation Kit v2, both using the manufacturer's protocol. 


16s analysis - for lefse feature selection OTUs were filtered to appear within at least 9 samples (size of each treatment group).



**High-throughput sequencing** 

16S

metaG
mock - Illumina HiSeq 2500 2x250
infected - Illumina NextSeq 2x150

average raw read counts

metaT
For all groups, sequencing was repeated across 4 lanes of an Illumina HiSeq 2500 using the 2x50 bp chemistry.



**Primary sequencing read curation** Raw sequencing read curation for both metagenomic and metatranscriptomic datasets was performed in a two step process. Residual 5’ and 3’ Illumina adapter sequences were trimmed using CutAdapt [@Martin2013] on a per library basis. Reads were quality trimmed using Sickle (Joshi, 2011) on the default settings. 

An average of \~300,000,000 total reads (both paired and orphaned) remained after quality trimming.


The 16S rRNA gene sequences were curated using the mothur software package (v1.36) as described in [@Jenior2017].


**Metagenomic contig assembly and gene annotation.** 

Megahit
Prodigal
screen for length
diamond against kegg protein




**Metatranscriptomic sequencing** 

Stranded RNA-Seq libraries were made constructed with the TruSeq Total RNA Library Preparation Kit v2. The Agilent DNA High Sensitivity Kit was used to measure concentration and fragment size distribution before sequencing. High-throughput sequencing was performed by the University of Michigan Sequencing Core in Ann Arbor, MI. For all groups, sequencing was repeated across 4 lanes of an Illumina HiSeq 2500 using the 2x50 bp chemistry.






**Metatranscriptomic read curation, mapping, and abundance normalization.** Similar to metagenomic read processing, raw transcript sequencing read curation was performed in a two step process. Residual 5’ and 3’ Illumina adapter sequences were trimmed using CutAdapt [@Martin2013] on a per library basis. Reads were quality trimmed using Sickle (Joshi, 2011) on the default settings. An average of \~300,000,000 total reads (both paired and orphaned) remained after quality trimming. Mapping was accomplished using Bowtie2 [@Langmead2009] and the default stringent settings. \~1,600,000 reads in sample each mapped to the annotated nucleotide gene 

Optical and PCR duplicates were then removed using Picard MarkDuplicates (http://broadinstitute.github.io/picard/), leaving ~150,000 reads per sample for final analysis. The remaining mappings were converted to idxstats format using Samtools [@Li2009] and the read counts per gene were tabulated. Discordant pair mappings were discarded and counts were then normalized to read length and gene length to give a per base report of gene coverage. Unless indicated otherwise, each collection of reads was then 1000-fold iteratively subsampled to 90% of the lowest sequence total within each analysis, and a median expression value for each gene was calculated.

**Metabolic modeling.**

Algorithm



**Quantification of *in vivo* metabolite relative concentrations.** For a more detailed description of the procedure, refer to Jenior et al. (2017) [@Jenior2017]. 
Metabolomic analysis performed by Metabolon (Durham, NC), a brief description of their methods is as follows. All methods utilized a Waters ACQUITY ultra-performance liquid chromatography (UPLC) and a Thermo Scientific Q-Exactive high resolution/accurate mass spectrometer interfaced with a heated electrospray ionization (HESI-II) source and Orbitrap mass analyzer at 35,000 mass resolution. Samples were dried then reconstituted in solvents compatible to each of the four methods. The first, in acidic positive conditions using a C18 column (Waters UPLC BEH C18-2.1x100 mm, 1.7 µm) using water and methanol, containing 0.05% perfluoropentanoic acid (PFPA) and 0.1% formic acid (FA). The second method was identical to the first but was chromatographically optimized for more hydrophobic compounds. The third approach utilized a basic negative ion optimized conditions using a separate dedicated C18 column. Basic extracts were gradient eluted from the column using methanol and water, however with 6.5mM Ammonium Bicarbonate at pH 8. Samples were then analyzed via negative ionization following elution from a hydrophilic interaction chromatography column (Waters UPLC BEH Amide 2.1x150 mm, 1.7 µm) using a gradient consisting of water and acetonitrile with 10mM Ammonium Formate, pH 10.8. The MS analysis alternated between MS and data-dependent MS n scans using dynamic exclusion. The scan range varied slighted between methods but covered 70-1000 m/z. Library matches for each compound were checked for each sample and corrected if necessary. Peaks were quantified using area under the curve.

**Statistical methods.** All statistical analyses were performed using R (v.3.2.0). Significant differences between community structure of treatment groups from 16S rRNA gene sequencing were determined with AMOVA in the mothur software package. Significant differences of Inv. Simpson diversity, cfu, toxin titer, and metabolite concentrations were determined by Wilcoxon signed-rank test with Benjamini-Hochberg correction. Undetectable points used half the limit of detection for all statistical calculations. Significant differences for growth curves compared to no carbohydrate control (+ amino acids) were calculated using 1-way ANOVA with Benjamini-Hochberg correction.


###Funding Information

This work was supported by funding from the National Institutes of Health to PDS (R01GM099514, P30DK034933, U19AI09087, and U01AI124255), VBY (P30DK034933, U19AI09087, and U01AI124255), a Translational Research Education Certificate grant to JLL (MICHR; UL1TR000433), and was partially supported by a predoctoral fellowship from the Cellular Biotechnology Training Program to MLJ (T32GM008353).


###Acknowledgments

The authors would like to acknowledge Charles Koumpouras for assistance with DNA extractions and metabolomic sample preparation. We would also like to acknowledge members of the University of Michigan Germfree Mouse Center, University of Michigan Sequencing Core, and Metabolon for their assistance in experimental design, execution, and data collection. Pooled and quality trimmed transcriptomic read data and experiment metadata are available through the NCBI Sequence Read Archive (SRA; PRJNA354635 and ). Data processing steps for beginning from raw sequence data to the final manuscript are hosted at 

**Author Affiliations**
**Department of Microbiology and Immunology, University of Michigan, Ann Arbor, Michigan.**
Matthew L. Jenior, Jhansi L. Leslie, & Patrick D. Schloss Ph.D.

**Author Contributions**
M.L.J. conceived, designed and performed experiments, analyzed data, and drafted the manuscript. J.L.L. performed experiments and analyzed data. P.D.S. interpreted data and contributed the manuscript.

The authors declare no conflicts of interest.

**Corresponding author**
Correspondence to [Patrick D. Schloss](pdschloss@umich.edu)


###Figure Legends

Abx table

**Figure 1 | Experimental models of *C. difficile* infection and their impact on bacterial populations in the gut microbiota.** **(a)** Experimental timelines of antibiotic pretreatment and infection mouse models. **(b)** Quantification of *C. difficile* cfu and toxin titer across antibiotic pretreatment models. Gray asterisks indicate significant difference from no antibiotic controls by Wilcoxon rank-sum test with the Benjamini-Hochberg correction (all *p* < 0.001). **(c)** Relative abundance of family-level taxonomic classification for OTUs in each treatment group. **(d-f)** Discriminating OTUs with LEfSe analysis between Mock and *C. difficile*-infected communities within each pretreatment group, *p*-values from LEfSe are shown on the left with taxonomic information (all *p* < 0.05). Relative abundance of the respective OTUs from each mouse along with medians are shown for each pretreatment group. Black asterisks indicate significant difference in relative abundance determined by Wilcoxon rank-sum test with Benjamini-Hochberg correction (*p* < 0.05).

**Figure 2 | *C. difficile* infection alters specific pathway and gene expression of the gut microbiota across perturbed communities** Metatranscriptomic (cDNA) read abundances associated with each gene were normalized to their associated metganomic (DNA) coverage, resulting in values that reflect upregulation and not basal expression levels of highly abundant genes. **(a)** Differences in read abundance for top 5 KEGG pathways with the largest amount of change between Mock and *C. difficile*-infected states within each antibiotic pretreatment. Values above the center line were expressed more during *C. difficile* infection, and those below the line were expressed more in Mock-infected animals. Dotted lines indicate average expression of pathways associated with each condition. **(b-d)** cDNA read abundances of the top 10 genes with the largest differences in expression within each indicated antibiotic pretreatment group. Shown are the expression levels for the genes displayed on the left during Mock (white) or *C. difficile* (black) infection. Gene names and member pathways indicated by letter codes along the left axis (pathway legend below). Abundances for each annotated pathway or gene were reported at the community-level and were agnostic to individual taxonomic group contributions to transcript pool.

**Figure 3 | *C. difficile* colonization alters gene expression of taxonomic groups differentially between antibiotic pretreatements.** Each point represents a unique gene from the respective metagenomic assembly. Coordinates determined by the log~2~-transformed expression level of each gene between *C. difficile*-infected and mock-infected conditions. Metatranscriptomic read abundances are normalized to their associated metganomic coverage. Colored indicate genus of origin, and gray areas denote genes with consistent expression between conditions determined by least squares regression analysis with a minimum residual value of 2. Experimental groups are shown as follows; **(a)** Streptomycin-pretreated, **(b)** Cefoperazone-pretreated, and **(c)** Clindamycin-pretreated. 



**Figure 4 | ** Community-level modeling schematic and example interaction scores
a-b Schematic of algorithm


**Figure 5 | ** 
- Most important metabolites at community level
- most important to each community member
- global correlation of importances and metabolomics




**Supplementary Figure 1 | Impact of antibiotic pretreatment and *C. difficile* infection on cecal community structure** **(a)** Inverse-Simpson diversity of cecal communities from all treatment groups. Gray stars indicate significant difference from no antibiotic controls (all *p* < 0.001). Black stars denote within treatment group significant difference between mock and *C. difficile*-infected communities. Differences were calculated using Wilcoxon rank-sum test with Benjamini-Hochberg correction. NMDS ordinations of Bray-Curtis distances comparing the groups labeled in the bottom left of each plotting area. **(b)** Antibiotic-pretreated compared to Untreated controls and **(c)** comparison between only antibiotic pretreatment groups. **(d-f)** Within antibiotic pretreatment comparisons for the effect of *C. difficile* colonization on community structure. Significant differences and correlation coefficients for ordination analyses were found using ANOSIM.



**Supplementary Figure ? | Rarefaction curves for reads?**


**Supplementary Figure 3 | **

**Supplementary Figure 4 | CONCOCT clustering**


### References
