points(x=clinda_630_archeae$clinda_mock_metaT_reads, y=clinda_630_archeae$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_630_archeae$color, col='gray10')
points(x=clinda_mock_archeae$clinda_mock_metaT_reads, y=clinda_mock_archeae$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_mock_archeae$color, col='gray10')
#-------------------#
# Taxonomic group legend
par(mar=c(0,1,3,0))
plot(0, type='n', axes=FALSE, xlab='', ylab='', xlim=c(-5,5), ylim=c(-10,10))
rect(xleft=-4.5, ybottom=10, xright=3.5, ytop=-5.5, border='black', lwd=2)
# Left side
text(x=c(-3,-3,1,1,1,1,0.5), y=c(9,2.4,9,5.5,2.4,0,-2.4), labels=c('Bacteroidetes', 'Firmicutes','Actinobacteria','Proteobacteria','Verrucomicrobia','Other Bacteria', 'Archeae'), cex=1.2) # Phyla
text(x=-2.5, y=c(8.3,7.6,6.9,6.2,5.5,4.8), labels=c('Allistipes','Bacteroides','Odoribacter','Parabacteroides','Prevotella','Porphymonas'), cex=0.9, font=3) # Bacteroietes
points(x=rep(-1.1,6), y=c(8.3,7.6,6.9,6.2,5.5,4.8), pch=22, cex=2.1, col='black', bg=c('#000099','#0000CC','#0000FF','#3333FF','#6666FF','#9999FF')) # blues
text(x=-2.5, y=c(1.7,1,0.3,-0.4,-1.1,-1.8,-2.5,-3.2,-3.9), labels=c('Clostridium','Enterococcus','Eubacterium','Lactobacillus','Lactococcus','Roseburia','Ruminococcus','Staphylococcus','Streptococcus'), cex=0.9, font=3) # Firmicutes
points(x=rep(-1.1,9), y=c(1.7,1,0.3,-0.4,-1.1,-1.8,-2.5,-3.2,-3.9), pch=22, cex=2.1, col='black', bg=c('#330000','#660000','#990000','#CC0000','#FF0000','#FF3333','#FF6666','#FF9999','#FFCCCC')) # reds
# Right side
text(x=1.5, y=c(8.3,7.6,6.9), labels=c('Bifidobacterium','Corynebacterium','Olsenella'), cex=1, font=3) # Actinobacteria
points(x=rep(2.75,3), y=c(8.3,7.6,6.9), pch=22, cex=2.2, col='black', bg=c('#006600','#009900','#33FF33')) # greens
text(x=1.5, y=4.8, labels='Escherichia', cex=1, font=3) # Proteobacteria
points(x=2.75, y=4.8, pch=22, cex=2.2, col='black', bg='#CCCC00') # yellow
text(x=1.5, y=1.7, labels='Akkermansia', cex=1, font=3) # Verrucomicrobia
points(x=2.75, y=1.7, pch=22, cex=2.2, col='black', bg='#990099') # purple
text(x=1.5, y=-0.85, labels='<0.1% Each', cex=1) # Other bacteria
points(x=2.75, y=-0.85, pch=22, cex=2.2, col='black', bg='white') # Other Bacteria - white
text(x=1.34, y=-3.1, labels='Methanobrevibacter', cex=1, font=3) # Archeae
points(x=2.75, y=-3.1, pch=22, cex=2.2, col='black', bg='#FF8000') # orange
#-------------------#
# Transcript abundance by species abundance
par(mar=c(5, 5, 2, 2), yaxs='i')
plot(1, type='n', ylim=c(0,15), xlim=c(0,8),
ylab='', xlab='', xaxt='n', yaxt='n', las=1)
axis(1, at=c(1,3,5,7), label=c('≤0.1%','>0.1% and ≤1%','>1% and ≤10%','>10% and ≤100%'),
tick=FALSE, cex.axis=1.7, font=2)
axis(2, at=c(0,5,10,15), cex.axis=1.5, las=1)
mtext('Genus-level Relative Abundance (16S)', side=1, padj=2.5, cex=1.2)
mtext(expression(paste('Absolute Difference in Metatranscriptome (',log[2],')')), side=2, padj=-1.5, cex=1.1)
minor.ticks.axis(2, 20, mn=0, mx=25)
abline(v=c(2,4,6), lwd=2)
abline(v=c(0.5,1,1.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
abline(v=c(2.5,3,3.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
abline(v=c(4.5,5,5.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
abline(v=c(6.5,7,7.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
box(lwd=2)
mtext('D', side=2, line=2, las=2, adj=1, padj=-10, cex=1.7, font=2)
# <0.1%
strep_01_n <- as.numeric(nrow(strep_genus_diff_01))
text(x=0.4, y=0.5, strep_01_n, cex=1.4)
other <- subset(strep_genus_diff_01, strep_genus_diff_01$color == 'white')
strep_genus_diff_01 <- subset(strep_genus_diff_01, strep_genus_diff_01$color != 'white')
stripchart(at=0.5, other$transcriptChange, pch=21, bg=other$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=0.5, rev(strep_genus_diff_01$transcriptChange), pch=21, bg=rev(strep_genus_diff_01$color),
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
temp <- subset(strep_genus_diff_01, rownames(strep_genus_diff_01) %in% c('Lactococcus','Roseburia','Prevotella','Akkermansia','Bifidobacterium') )
stripchart(at=0.5, temp$transcriptChange, pch=21, bg=temp$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
cef_01_n <- as.numeric(nrow(cef_genus_diff_01))
text(x=0.9, y=0.5, cef_01_n, cex=1.4)
other <- subset(cef_genus_diff_01, cef_genus_diff_01$color == 'white')
cef_genus_diff_01 <- subset(cef_genus_diff_01, cef_genus_diff_01$color != 'white')
stripchart(at=1, other$transcriptChange, pch=21, bg=other$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=1, cef_genus_diff_01$transcriptChange, pch=21, bg=cef_genus_diff_01$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
temp <- subset(cef_genus_diff_01, rownames(cef_genus_diff_01) %in% c('Allistipes','Odoribacter','Parabacteroides') )
stripchart(at=1, temp$transcriptChange, pch=21, bg=temp$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
clinda_01_n <- as.numeric(nrow(clinda_genus_diff_01))
text(x=1.4, y=0.5, clinda_01_n, cex=1.4)
other <- subset(clinda_genus_diff_01, clinda_genus_diff_01$color == 'white')
clinda_genus_diff_01 <- subset(clinda_genus_diff_01, clinda_genus_diff_01$color != 'white')
stripchart(at=1.5, other$transcriptChange, pch=21, bg=other$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=1.5, clinda_genus_diff_01$transcriptChange, pch=21, bg=clinda_genus_diff_01$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
temp <- subset(clinda_genus_diff_01, rownames(clinda_genus_diff_01) %in% c('Bifidobacterium','Parabacteroides') )
stripchart(at=1.5, temp$transcriptChange, pch=21, bg=temp$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
# >0.1% and <1%
stripchart(at=2.5, strep_genus_diff_01_1$transcriptChange, pch=21, bg=strep_genus_diff_01_1$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=3, cef_genus_diff_01_1$transcriptChange, pch=21, bg=cef_genus_diff_01_1$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=3.5, clinda_genus_diff_01_1$transcriptChange, pch=21, bg=clinda_genus_diff_01_1$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
# >1% and <10%
stripchart(at=4.5, strep_genus_diff_1_10$transcriptChange, pch=21, bg=strep_genus_diff_1_10$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=5, cef_genus_diff_1_10$transcriptChange, pch=21, bg=cef_genus_diff_1_10$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=5.5, clinda_genus_diff_1_10$transcriptChange, pch=21, bg=clinda_genus_diff_1_10$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
# >10% and <100%
stripchart(at=6.5, strep_genus_diff_10_100$transcriptChange, pch=21, bg=strep_genus_diff_10_100$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=7, cef_genus_diff_10_100$transcriptChange, pch=21, bg=cef_genus_diff_10_100$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=7.5, clinda_genus_diff_10_100$transcriptChange, pch=21, bg=clinda_genus_diff_10_100$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
par(xpd=TRUE)
legend(x=0.25, y=16.5, legend=c('Streptomycin-pretreated','Cefoperazone-pretreated','Clindamycin-pretreated'),
bty='n', col=c(strep_col,cef_col,clinda_col), pch=c(1,16), cex=1.7, pt.cex=0, lty=5, lwd=2.5, ncol=3)
dev.off()
tiff(filename=plot_file, width=10, height=15, units='in',
res=200, pointsize=12, compression='none')
layout(matrix(c(1,2,
3,4,
5,5),
nrow=3, ncol=2, byrow = TRUE))
par(mar=c(5, 5, 1, 1), mgp=c(3,0.7,0))
#-------------------#
# Streptomycin
plot(0, type='n', xlim=c(0,12), ylim=c(0,12), pch=20, xaxt='n', yaxt='n', xlab='', ylab='')
filledrectangle(wx=20, wy=2.8, col='gray80', mid=c(6,6), angle=45)
box(lwd=2)
points(x=strep_annotated$strep_mock_metaT_reads, y=strep_annotated$strep_630_metaT_reads, pch=20, cex=1.3, col='gray40')
segments(-2, -2, 14, 14, lty=2)
axis(1, at=seq(0,12,2), label=seq(0,12,2), cex=1.3)
axis(2, at=seq(0,12,2), label=seq(0,12,2), cex=1.3, las=1)
minor.ticks.axis(1, 10, mn=0, mx=12)
minor.ticks.axis(2, 10, mn=0, mx=12)
mtext(expression(paste('Normalized cDNA Abundance (',log[2],')')), side=1, padj=2.25, cex=0.9)
mtext('Mock-Infected', side=1, padj=3.7, font=2)
mtext(expression(paste('Normalized cDNA Abundance (',log[2],')')), side=2, padj=-1.75, cex=0.9)
mtext(expression(bolditalic('C. difficile')~bold('-Infected')), side=2, padj=-3.5, font=2)
legend('topleft', c('Streptomycin-pretreated', as.expression(bquote(paste(italic('R'),' = ',.(strep_corr))))), bty='n', cex=1.5, text.col=c(strep_col,'black'))
mtext('A', side=2, line=2, las=2, adj=1, padj=-9.5, cex=1.7, font=2)
points(x=strep_630_outliers_other$strep_mock_metaT_reads, y=strep_630_outliers_other$strep_630_metaT_reads, cex=1.7, pch=21, col='gray10', lwd=1.5, bg=strep_630_outliers_other$color)
points(x=strep_mock_outliers_other$strep_mock_metaT_reads, y=strep_mock_outliers_other$strep_630_metaT_reads, cex=1.7, pch=21, col='gray10', lwd=1.5, bg=strep_mock_outliers_other$color)
points(x=strep_630_outliers$strep_mock_metaT_reads, y=strep_630_outliers$strep_630_metaT_reads, cex=1.7, pch=21, bg=strep_630_outliers$color, col='gray10')
points(x=strep_mock_outliers$strep_mock_metaT_reads, y=strep_mock_outliers$strep_630_metaT_reads, cex=1.7, pch=21, bg=strep_mock_outliers$color, col='gray10')
points(x=strep_630_actino$strep_mock_metaT_reads, y=strep_630_actino$strep_630_metaT_reads, cex=1.7, pch=21, bg=strep_630_actino$color, col='gray10')
points(x=strep_mock_actino$strep_mock_metaT_reads, y=strep_mock_actino$strep_630_metaT_reads, cex=1.7, pch=21, bg=strep_mock_actino$color, col='gray10')
points(x=strep_630_archeae$strep_mock_metaT_reads, y=strep_630_archeae$strep_630_metaT_reads, cex=1.7, pch=21, bg=strep_630_archeae$color, col='gray10')
points(x=strep_mock_archeae$strep_mock_metaT_reads, y=strep_mock_archeae$strep_630_metaT_reads, cex=1.7, pch=21, bg=strep_mock_archeae$color, col='gray10')
#-------------------#
# Cefoperazone
plot(0, type='n', xlim=c(0,12), ylim=c(0,12), pch=20, xaxt='n', yaxt='n', xlab='', ylab='')
filledrectangle(wx=20, wy=2.8, col='gray80', mid=c(6,6), angle=45)
box(lwd=2)
points(x=cef_annotated$cef_mock_metaT_reads, y=cef_annotated$cef_630_metaT_reads, pch=20, cex=1.3, col='gray40')
segments(-2, -2, 14, 14, lty=2)
axis(1, at=seq(0,12,2), label=seq(0,12,2), cex=1.3)
axis(2, at=seq(0,12,2), label=seq(0,12,2), cex=1.3, las=1)
minor.ticks.axis(1, 10, mn=0, mx=12)
minor.ticks.axis(2, 10, mn=0, mx=12)
mtext(expression(paste('Normalized cDNA Abundance (',log[2],')')), side=1, padj=2.25, cex=0.9)
mtext('Mock-Infected', side=1, padj=3.7, font=2)
mtext(expression(paste('Normalized cDNA Abundance (',log[2],')')), side=2, padj=-1.75, cex=0.9)
mtext(expression(bolditalic('C. difficile')~bold('-Infected')), side=2, padj=-3.5, font=2)
legend('topleft', c('Cefoperazone-pretreated', as.expression(bquote(paste(italic('R'),' = ',.(cef_corr))))), bty='n', cex=1.5, text.col=c(cef_col,'black'))
mtext('B', side=2, line=2, las=2, adj=1, padj=-9.5, cex=1.7, font=2)
points(x=cef_630_outliers_other$cef_mock_metaT_reads, y=cef_630_outliers_other$cef_630_metaT_reads, cex=1.7, pch=21, col='gray10', lwd=1.5, bg=cef_630_outliers_other$color)
points(x=cef_mock_outliers_other$cef_mock_metaT_reads, y=cef_mock_outliers_other$cef_630_metaT_reads, cex=1.7, pch=21, col='gray10', lwd=1.5, bg=cef_mock_outliers_other$color)
points(x=cef_630_outliers$cef_mock_metaT_reads, y=cef_630_outliers$cef_630_metaT_reads, cex=1.7, pch=21, bg=cef_630_outliers$color, col='gray10')
points(x=cef_mock_outliers$cef_mock_metaT_reads, y=cef_mock_outliers$cef_630_metaT_reads, cex=1.7, pch=21, bg=cef_mock_outliers$color, col='gray10')
points(x=cef_630_actino$cef_mock_metaT_reads, y=cef_630_actino$cef_630_metaT_reads, cex=1.7, pch=21, bg=cef_630_actino$color, col='gray10')
points(x=cef_mock_actino$cef_mock_metaT_reads, y=cef_mock_actino$cef_630_metaT_reads, cex=1.7, pch=21, bg=cef_mock_actino$color, col='gray10')
points(x=cef_630_archeae$cef_mock_metaT_reads, y=cef_630_archeae$cef_630_metaT_reads, cex=1.7, pch=21, bg=cef_630_archeae$color, col='gray10')
points(x=cef_mock_archeae$cef_mock_metaT_reads, y=cef_mock_archeae$cef_630_metaT_reads, cex=1.7, pch=21, bg=cef_mock_archeae$color, col='gray10')
#-------------------#
# Clindamycin
plot(0, type='n', xlim=c(0,12), ylim=c(0,12), pch=20, xaxt='n', yaxt='n', xlab='', ylab='')
filledrectangle(wx=20, wy=2.8, col='gray80', mid=c(6,6), angle=45)
box(lwd=2)
points(x=clinda_annotated$clinda_mock_metaT_reads, y=clinda_annotated$clinda_630_metaT_reads, pch=20, cex=1.3, col='gray40')
segments(-2, -2, 14, 14, lty=2)
axis(1, at=seq(0,12,2), label=seq(0,12,2), cex=1.3)
axis(2, at=seq(0,12,2), label=seq(0,12,2), cex=1.3, las=1)
minor.ticks.axis(1, 10, mn=0, mx=12)
minor.ticks.axis(2, 10, mn=0, mx=12)
mtext(expression(paste('Normalized cDNA Abundance (',log[2],')')), side=1, padj=2.25, cex=0.9)
mtext('Mock-Infected', side=1, padj=3.7, font=2)
mtext(expression(paste('Normalized cDNA Abundance (',log[2],')')), side=2, padj=-1.75, cex=0.9)
mtext(expression(bolditalic('C. difficile')~bold('-Infected')), side=2, padj=-3.5, font=2)
legend('topleft', c('Clindamycin-pretreated', as.expression(bquote(paste(italic('R'),' = ',.(clinda_corr))))), bty='n', cex=1.5, text.col=c(clinda_col,'black'))
mtext('C', side=2, line=2, las=2, adj=1, padj=-9.5, cex=1.7, font=2)
points(x=clinda_630_outliers_other$clinda_mock_metaT_reads, y=clinda_630_outliers_other$clinda_630_metaT_reads, cex=1.7, pch=21, col='gray10', lwd=1.5, bg=clinda_630_outliers_other$color)
points(x=clinda_mock_outliers_other$clinda_mock_metaT_reads, y=clinda_mock_outliers_other$clinda_630_metaT_reads, cex=1.7, pch=21, col='gray10', lwd=1.5, bg=clinda_mock_outliers_other$color)
points(x=clinda_630_outliers$clinda_mock_metaT_reads, y=clinda_630_outliers$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_630_outliers$color, col='gray10')
points(x=clinda_mock_outliers$clinda_mock_metaT_reads, y=clinda_mock_outliers$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_mock_outliers$color, col='gray10')
points(x=clinda_630_actino$clinda_mock_metaT_reads, y=clinda_630_actino$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_630_actino$color, col='gray10')
points(x=clinda_mock_actino$clinda_mock_metaT_reads, y=clinda_mock_actino$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_mock_actino$color, col='gray10')
points(x=clinda_630_archeae$clinda_mock_metaT_reads, y=clinda_630_archeae$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_630_archeae$color, col='gray10')
points(x=clinda_mock_archeae$clinda_mock_metaT_reads, y=clinda_mock_archeae$clinda_630_metaT_reads, cex=1.7, pch=21, bg=clinda_mock_archeae$color, col='gray10')
#-------------------#
# Taxonomic group legend
par(mar=c(0,1,3,0))
plot(0, type='n', axes=FALSE, xlab='', ylab='', xlim=c(-5,5), ylim=c(-10,10))
rect(xleft=-4.5, ybottom=10, xright=3.5, ytop=-5.5, border='black', lwd=2)
# Left side
text(x=c(-3,-3,1,1,1,1,0.5), y=c(9,2.4,9,5.5,2.4,0,-2.4), labels=c('Bacteroidetes', 'Firmicutes','Actinobacteria','Proteobacteria','Verrucomicrobia','Other Bacteria', 'Archeae'), cex=1.2) # Phyla
text(x=-2.5, y=c(8.3,7.6,6.9,6.2,5.5,4.8), labels=c('Allistipes','Bacteroides','Odoribacter','Parabacteroides','Prevotella','Porphymonas'), cex=0.9, font=3) # Bacteroietes
points(x=rep(-1.1,6), y=c(8.3,7.6,6.9,6.2,5.5,4.8), pch=22, cex=2.1, col='black', bg=c('#000099','#0000CC','#0000FF','#3333FF','#6666FF','#9999FF')) # blues
text(x=-2.5, y=c(1.7,1,0.3,-0.4,-1.1,-1.8,-2.5,-3.2,-3.9), labels=c('Clostridium','Enterococcus','Eubacterium','Lactobacillus','Lactococcus','Roseburia','Ruminococcus','Staphylococcus','Streptococcus'), cex=0.9, font=3) # Firmicutes
points(x=rep(-1.1,9), y=c(1.7,1,0.3,-0.4,-1.1,-1.8,-2.5,-3.2,-3.9), pch=22, cex=2.1, col='black', bg=c('#330000','#660000','#990000','#CC0000','#FF0000','#FF3333','#FF6666','#FF9999','#FFCCCC')) # reds
# Right side
text(x=1.5, y=c(8.3,7.6,6.9), labels=c('Bifidobacterium','Corynebacterium','Olsenella'), cex=1, font=3) # Actinobacteria
points(x=rep(2.75,3), y=c(8.3,7.6,6.9), pch=22, cex=2.2, col='black', bg=c('#006600','#009900','#33FF33')) # greens
text(x=1.5, y=4.8, labels='Escherichia', cex=1, font=3) # Proteobacteria
points(x=2.75, y=4.8, pch=22, cex=2.2, col='black', bg='#CCCC00') # yellow
text(x=1.5, y=1.7, labels='Akkermansia', cex=1, font=3) # Verrucomicrobia
points(x=2.75, y=1.7, pch=22, cex=2.2, col='black', bg='#990099') # purple
text(x=1.5, y=-0.85, labels='<0.1% Each', cex=1) # Other bacteria
points(x=2.75, y=-0.85, pch=22, cex=2.2, col='black', bg='white') # Other Bacteria - white
text(x=1.34, y=-3.1, labels='Methanobrevibacter', cex=1, font=3) # Archeae
points(x=2.75, y=-3.1, pch=22, cex=2.2, col='black', bg='#FF8000') # orange
#-------------------#
# Transcript abundance by species abundance
par(mar=c(5, 5, 2, 2), yaxs='i')
plot(1, type='n', ylim=c(0,15), xlim=c(0,8),
ylab='', xlab='', xaxt='n', yaxt='n', las=1)
axis(1, at=c(1,3,5,7), label=c('≤0.1%','>0.1% and ≤1%','>1% and ≤10%','>10% and ≤100%'),
tick=FALSE, cex.axis=1.7, font=2)
axis(2, at=c(0,5,10,15), cex.axis=1.5, las=1)
mtext('Genus-level Relative Abundance (16S)', side=1, padj=2.5, cex=1.2)
mtext(expression(paste('Absolute Difference in Metatranscriptome (',log[2],')')), side=2, padj=-1.5, cex=1.1)
minor.ticks.axis(2, 20, mn=0, mx=25)
abline(v=c(2,4,6), lwd=2)
abline(v=c(0.5,1,1.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
abline(v=c(2.5,3,3.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
abline(v=c(4.5,5,5.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
abline(v=c(6.5,7,7.5), lwd=2, lty=5, col=c(strep_col,cef_col,clinda_col))
box(lwd=2)
mtext('D', side=2, line=2, las=2, adj=1, padj=-10, cex=1.7, font=2)
# <0.1%
strep_01_n <- as.numeric(nrow(strep_genus_diff_01))
text(x=0.35, y=0.5, strep_01_n, cex=1.4)
other <- subset(strep_genus_diff_01, strep_genus_diff_01$color == 'white')
strep_genus_diff_01 <- subset(strep_genus_diff_01, strep_genus_diff_01$color != 'white')
stripchart(at=0.5, other$transcriptChange, pch=21, bg=other$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=0.5, rev(strep_genus_diff_01$transcriptChange), pch=21, bg=rev(strep_genus_diff_01$color),
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
temp <- subset(strep_genus_diff_01, rownames(strep_genus_diff_01) %in% c('Lactococcus','Roseburia','Prevotella','Akkermansia','Bifidobacterium') )
stripchart(at=0.5, temp$transcriptChange, pch=21, bg=temp$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
cef_01_n <- as.numeric(nrow(cef_genus_diff_01))
text(x=0.85, y=0.5, cef_01_n, cex=1.4)
other <- subset(cef_genus_diff_01, cef_genus_diff_01$color == 'white')
cef_genus_diff_01 <- subset(cef_genus_diff_01, cef_genus_diff_01$color != 'white')
stripchart(at=1, other$transcriptChange, pch=21, bg=other$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=1, cef_genus_diff_01$transcriptChange, pch=21, bg=cef_genus_diff_01$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
temp <- subset(cef_genus_diff_01, rownames(cef_genus_diff_01) %in% c('Allistipes','Odoribacter','Parabacteroides') )
stripchart(at=1, temp$transcriptChange, pch=21, bg=temp$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
clinda_01_n <- as.numeric(nrow(clinda_genus_diff_01))
text(x=1.35, y=0.5, clinda_01_n, cex=1.4)
other <- subset(clinda_genus_diff_01, clinda_genus_diff_01$color == 'white')
clinda_genus_diff_01 <- subset(clinda_genus_diff_01, clinda_genus_diff_01$color != 'white')
stripchart(at=1.5, other$transcriptChange, pch=21, bg=other$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=1.5, clinda_genus_diff_01$transcriptChange, pch=21, bg=clinda_genus_diff_01$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
temp <- subset(clinda_genus_diff_01, rownames(clinda_genus_diff_01) %in% c('Bifidobacterium','Parabacteroides') )
stripchart(at=1.5, temp$transcriptChange, pch=21, bg=temp$color,
method='jitter', jitter=0.09, cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
# >0.1% and <1%
stripchart(at=2.5, strep_genus_diff_01_1$transcriptChange, pch=21, bg=strep_genus_diff_01_1$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=3, cef_genus_diff_01_1$transcriptChange, pch=21, bg=cef_genus_diff_01_1$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=3.5, clinda_genus_diff_01_1$transcriptChange, pch=21, bg=clinda_genus_diff_01_1$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
# >1% and <10%
stripchart(at=4.5, strep_genus_diff_1_10$transcriptChange, pch=21, bg=strep_genus_diff_1_10$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=5, cef_genus_diff_1_10$transcriptChange, pch=21, bg=cef_genus_diff_1_10$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=5.5, clinda_genus_diff_1_10$transcriptChange, pch=21, bg=clinda_genus_diff_1_10$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
# >10% and <100%
stripchart(at=6.5, strep_genus_diff_10_100$transcriptChange, pch=21, bg=strep_genus_diff_10_100$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=7, cef_genus_diff_10_100$transcriptChange, pch=21, bg=cef_genus_diff_10_100$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
stripchart(at=7.5, clinda_genus_diff_10_100$transcriptChange, pch=21, bg=clinda_genus_diff_10_100$color,
cex=2.5, lwd=1.5, vertical=TRUE, add=TRUE)
par(xpd=TRUE)
legend(x=0.25, y=16.5, legend=c('Streptomycin-pretreated','Cefoperazone-pretreated','Clindamycin-pretreated'),
bty='n', col=c(strep_col,cef_col,clinda_col), pch=c(1,16), cex=1.7, pt.cex=0, lty=5, lwd=2.5, ncol=3)
dev.off()
# Clean up
for (dep in deps){
pkg <- paste('package:', dep, sep='')
detach(pkg, character.only = TRUE)}
setwd(starting_dir)
rm(list=ls())
gc()
# Set up environment
rm(list=ls())
gc()
# Load in functions
starting_dir <- getwd()
source('~/Desktop/Repositories/Jenior_Metatranscriptomics_PLOSPathogens_2017/code/R/functions.R')
# Output plot name
plot_ab <- 'results/figures/figure_3ab.pdf'
plot_c <- 'results/figures/figure_3c.pdf'
plot_d <- 'results/figures/figure_3d.pdf'
# Input Metabolomes
metabolome_file <- 'data/metabolome/scaled_intensities.log10.tsv'
# Input Metadata
metadata_file <- 'data/metadata.tsv'
#----------------#
# Read in data
# Metabolomes
metabolome <- read.delim(metabolome_file, sep='\t', header=TRUE)
rm(metabolome_file)
# Metadata
metadata <- read.delim(metadata_file, sep='\t', header=T, row.names=1)
rm(metadata_file)
#-------------------------------------------------------------------------------------------------------------------------#
# Format data
# Metadata
metadata$type <- NULL
metadata$cage <- NULL
metadata$mouse <- NULL
metadata$gender <- NULL
# Metabolomes
metabolome$BIOCHEMICAL <- gsub('_', ' ', metabolome$BIOCHEMICAL)
rownames(metabolome) <- metabolome$BIOCHEMICAL
metabolome$BIOCHEMICAL <- NULL
metabolome$PUBCHEM <- NULL
metabolome$KEGG <- NULL
metabolome$SUB_PATHWAY <- NULL
metabolome$SUPER_PATHWAY <- NULL
metabolome <- as.data.frame(t(metabolome))
#-------------------------------------------------------------------------------------------------------------------------#
# Stats
# Prep data
metabolome <- clean_merge(metadata, metabolome)
metabolome <- subset(metabolome, abx != 'germfree')
metabolome <- subset(metabolome, infection == 'mock')
abx_metabolome <- subset(metabolome, abx != 'none')
abx_metabolome$infection <- NULL
abx_metabolome$susceptibility <- NULL
metabolome$abx <- NULL
metabolome$infection <- NULL
# Calculate significant differences
noabx_p <- round(adonis(metabolome[,2:ncol(metabolome)]~factor(metabolome$susceptibility), data=metabolome, permutations=10000, method='jaccard')$aov.tab[[6]][1], 3)
abx_p <- round(adonis(abx_metabolome[,2:ncol(abx_metabolome)]~factor(abx_metabolome$abx), data=abx_metabolome, permutations=10000, method='jaccard')$aov.tab[[6]][1], 3)
metabolome$susceptibility <- NULL
abx_metabolome$abx <-  NULL
#-------------------------------------------------------------------------------------------------------------------------#
# Calculate axes
# Metabolome - all
metabolome_nmds <- metaMDS(metabolome, k=2, trymax=100, distance='bray')$points
metabolome_nmds <- clean_merge(metadata, metabolome_nmds)
metabolome_nmds$MDS1 <- metabolome_nmds$MDS1 - 0.1
# Subset NMDS axes to color points - all
metabolome_cefoperazone <- subset(metabolome_nmds, abx == 'cefoperazone')
metabolome_cefoperazone_mock <- subset(metabolome_cefoperazone, infection == 'mock')
rm(metabolome_cefoperazone)
metabolome_clindamycin <- subset(metabolome_nmds, abx == 'clindamycin')
metabolome_clindamycin_mock <- subset(metabolome_clindamycin, infection == 'mock')
rm(metabolome_clindamycin)
metabolome_streptomycin <- subset(metabolome_nmds, abx == 'streptomycin')
metabolome_streptomycin_mock <- subset(metabolome_streptomycin, infection == 'mock')
rm(metabolome_streptomycin)
metabolome_noantibiotics <- subset(metabolome_nmds, abx == 'none')
# Separate analysis for abx only
# Calculate axes and merge with metadata
abx_metabolome_nmds <- metaMDS(abx_metabolome, k=2, trymax=100)$points
abx_metabolome_nmds <- clean_merge(metadata, abx_metabolome_nmds)
abx_metabolome_nmds$MDS1 <- abx_metabolome_nmds$MDS1 - 0.06
# Subset to points for plot
metabolome_abx <- subset(abx_metabolome_nmds, abx == 'cefoperazone')
metabolome_abx_cef_mock <- subset(metabolome_abx, infection == 'mock')
metabolome_abx <- subset(abx_metabolome_nmds, abx == 'clindamycin')
metabolome_abx_clinda_mock <- subset(metabolome_abx, infection == 'mock')
metabolome_abx <- subset(abx_metabolome_nmds, abx == 'streptomycin')
metabolome_abx_strep_mock <- subset(metabolome_abx, infection == 'mock')
#-------------------------------------------------------------------------------------------------------------------------#
# Feature selection
# Separate groups
metabolome <- clean_merge(metadata, metabolome)
abx_metabolome <- subset(metabolome, abx != 'none')
abx_metabolome$infection <- NULL
abx_metabolome$susceptibility <- NULL
metabolome$infection <- NULL
metabolome$abx <- NULL
# Random Forest feature selection/reduction (to 0% OOB)
colnames(metabolome) <- make.names(colnames(metabolome))
all_rf <- aucrfSusceptibility(metabolome)
colnames(abx_metabolome) <- make.names(colnames(abx_metabolome))
abx_rf <- abxRF(abx_metabolome)
abx_rf <- importance(abx_rf, type=1)
abx_rf <- as.data.frame(abx_rf)
abx_rf$features <- rownames(abx_rf)
abx_rf <- abx_rf[order(-abx_rf$MeanDecreaseAccuracy),]$features[1:5]
abx_metabolome <- abx_metabolome[,abx_rf]
abx_metabolome <- clean_merge(metadata, abx_metabolome)
abx_metabolome$infection <- NULL
abx_metabolome$susceptibility <- NULL
rm(metadata)
abx_rf <- abxRF(abx_metabolome)
# Get features
all_rf <- as.character(OptimalSet(all_rf)$Name)
res_metabolome <- subset(metabolome, susceptibility == 'resistant')[, all_rf]
res_metabolome$susceptibility <- NULL
sus_metabolome <- subset(metabolome, susceptibility == 'susceptible')[, all_rf]
sus_metabolome$susceptibility <- NULL
rm(metabolome, all_rf)
cef_abx_metabolome <- subset(abx_metabolome, abx == 'cefoperazone')
cef_abx_metabolome$abx <- NULL
clinda_abx_metabolome <- subset(abx_metabolome, abx == 'clindamycin')
clinda_abx_metabolome$abx <- NULL
strep_abx_metabolome <- subset(abx_metabolome, abx == 'streptomycin')
strep_abx_metabolome$abx <- NULL
rm(abx_metabolome, abx_rf)
# Find significant differences
resistant_pvalues <- c()
for (i in 1:ncol(res_metabolome)){resistant_pvalues[i] <- wilcox.test(res_metabolome[,i], sus_metabolome[,i], exact=FALSE)$p.value}
resistant_pvalues <- p.adjust(resistant_pvalues, method='BH')
abx_pvalues1 <- c()
for (i in 1:ncol(cef_abx_metabolome)){abx_pvalues1[i] <- wilcox.test(cef_abx_metabolome[,i], clinda_abx_metabolome[,i], exact=FALSE)$p.value}
abx_pvalues2 <- c()
for (i in 1:ncol(cef_abx_metabolome)){abx_pvalues2[i] <- wilcox.test(cef_abx_metabolome[,i], strep_abx_metabolome[,i], exact=FALSE)$p.value}
abx_pvalues3 <- c()
for (i in 1:ncol(clinda_abx_metabolome)){abx_pvalues3[i] <- wilcox.test(clinda_abx_metabolome[,i], strep_abx_metabolome[,i], exact=FALSE)$p.value}
abx_pvalues1 <- p.adjust(abx_pvalues1, method='BH')
abx_pvalues1[is.na(abx_pvalues1)] <- 0
abx_pvalues2 <- p.adjust(abx_pvalues2, method='BH')
abx_pvalues2[is.na(abx_pvalues2)] <- 0
abx_pvalues3 <- p.adjust(abx_pvalues3, method='BH')
abx_pvalues3[is.na(abx_pvalues3)] <- 0
# Reformat metabolite names
colnames(res_metabolome) <- c("Nudifloramide","N-Acetylproline","Sebacate / Decanedioate","Hyodeoxycholate","Murideoxycholate")
colnames(sus_metabolome) <- c("Nudifloramide","N-Acetylproline","Sebacate / Decanedioate","Hyodeoxycholate","Murideoxycholate")
colnames(strep_abx_metabolome) <- c("Nicotinamide","Biotin","Pheophorbide A","gamma-Glutamylmethionine","cis-4-Decenoylcarnitine")
colnames(cef_abx_metabolome) <- c("Nicotinamide","Biotin","Pheophorbide A","gamma-Glutamylmethionine","cis-4-Decenoylcarnitine")
colnames(strep_abx_metabolome) <- c("Nicotinamide","Biotin","Pheophorbide A","gamma-Glutamylmethionine","cis-4-Decenoylcarnitine")
pdf(file=plot_d, width=4, height=ncol(strep_abx_metabolome)*1.5)
layout(matrix(c(1:(ncol(strep_abx_metabolome)+2)), nrow=(ncol(strep_abx_metabolome)+2), ncol=1, byrow = TRUE))
par(mar=c(0.2, 0, 0, 2), mgp=c(2.3, 0.75, 0), xpd=FALSE)
plot(0, type='n', axes=FALSE, xlab='', ylab='', xlim=c(-10,10), ylim=c(-5,5))
legend('bottomright', legend=c('Streptomycin', 'Cefoperazone', 'Clindamycin'), bty='n',
pt.bg=c(strep_col,cef_col,clinda_col), pch=21, cex=1.2, pt.cex=2, ncol=3)
par(mar=c(0.2, 2, 0.2, 2.5), mgp=c(2.3, 0.75, 0), xpd=FALSE, yaxs='i')
for(i in c(1:(ncol(strep_abx_metabolome)))){
xmax <- ceiling(max(c(max(strep_abx_metabolome[,i]), max(cef_abx_metabolome[,i]), max(clinda_abx_metabolome[,i]))))
while(xmax %% 5 != 0 ){xmax <- xmax + 1}
plot(0, type='n', xlab='', ylab='', xaxt='n', yaxt='n', xlim=c(0,xmax), ylim=c(0.3,2.25))
stripchart(at=1.65, jitter(strep_abx_metabolome[,i], amount=1e-5),
pch=21, bg=strep_col, method='jitter', jitter=0.12, cex=2, lwd=0.5, add=TRUE)
stripchart(at=1.2, jitter(cef_abx_metabolome[,i], amount=1e-5),
pch=21, bg=cef_col, method='jitter', jitter=0.12, cex=2, lwd=0.5, add=TRUE)
stripchart(at=0.66, jitter(clinda_abx_metabolome[,i], amount=1e-5),
pch=21, bg=clinda_col, method='jitter', jitter=0.12, cex=2, lwd=0.5, add=TRUE)
metabolite <- colnames(strep_abx_metabolome)[i]
legend('topright', legend=metabolite, pch=1, cex=1.3, pt.cex=0, bty='n')
mtext('|', side=4, cex=1.6, las=1, adj=-0.3, padj=-0.5)
mtext('|', side=4, cex=1.6, las=1, adj=-0.3, padj=-0.3)
mtext('|', side=4, cex=1.6, las=1, adj=-0.3, padj=1.7)
mtext('|', side=4, cex=1.6, las=1, adj=-0.3, padj=1.5)
mtext('|', side=4, cex=1.6, las=1, adj=-2.5, padj=-0.5)
mtext('|', side=4, cex=1.6, las=1, adj=-2.5, padj=-0.3)
mtext('|', side=4, cex=1.6, las=1, adj=-2.5, padj=0)
mtext('|', side=4, cex=1.6, las=1, adj=-2.5, padj=0.5)
mtext('|', side=4, cex=1.6, las=1, adj=-2.5, padj=1.5)
mtext('|', side=4, cex=1.6, las=1, adj=-2.5, padj=1.7)
if (abx_pvalues2[i] <= 0.05){
mtext('*', side=4, font=2, cex=1, padj=0.8, adj=0.64)
} else {
mtext('n.s.', cex=0.7, side=4, padj=0.5, adj=0.64)
}
if (abx_pvalues1[i] <= 0.05){
mtext('*', side=4, font=2, cex=1, padj=0.8, adj=0.27)
} else {
mtext('n.s.', cex=0.7, side=4, padj=0.5, adj=0.27)
}
if (abx_pvalues3[i] <= 0.05){
mtext('*', side=4, font=2, cex=1, padj=2.2, adj=0.45)
} else {
mtext('n.s.', cex=0.7, side=4, padj=2.4, adj=0.45)
}
if (xmax <= 10) {
text(x=seq(0,xmax,1), y=0.42, labels=seq(0,xmax,1), cex=1)
axis(1, at=seq(0,5,1), NA, cex.axis=0.8, tck=0.015)
} else if (xmax > 1000){
text(x=seq(0,xmax,200), y=0.42, labels=seq(0,xmax,200), cex=1)
axis(1, at=seq(0,xmax,200), NA, cex.axis=0.8, tck=0.015)
} else if (xmax > 500){
text(x=seq(0,xmax,100), y=0.42, labels=seq(0,xmax,100), cex=1)
axis(1, at=seq(0,xmax,100), NA, cex.axis=0.8, tck=0.015)
} else if (xmax > 100){
text(x=seq(0,xmax,50), y=0.42, labels=seq(0,xmax,50), cex=1)
axis(1, at=seq(0,xmax,50), NA, cex.axis=0.8, tck=0.015)
} else if (xmax > 50){
text(x=seq(0,xmax,10), y=0.42, labels=seq(0,xmax,10), cex=1)
axis(1, at=seq(0,xmax,10), NA, cex.axis=0.8, tck=0.015)
} else {
text(x=seq(0,xmax,5), y=0.42, labels=seq(0,xmax,5), cex=1)
axis(1, at=seq(0,xmax,5), NA, cex.axis=0.8, tck=0.015)
}
segments(median(strep_abx_metabolome[,i]), 1.48, median(strep_abx_metabolome[,i]), 1.82, lwd=2.5)
segments(median(cef_abx_metabolome[,i]), 1.03, median(cef_abx_metabolome[,i]), 1.37, lwd=2.5)
segments(median(clinda_abx_metabolome[,i]), 0.49, median(clinda_abx_metabolome[,i]), 0.83, lwd=2.5)
}
par(mar=c(0, 0, 0, 0))
plot(0, type='n', axes=FALSE, xlab='', ylab='', xlim=c(-10,10), ylim=c(-5,5))
text(x=0, y=4, labels=expression(paste('Scaled Intensity (',log[10],')')), cex=1.4)
text(x=7, y=4.5, labels='OOB Error = 0.0%')
dev.off()
# Clean up
for (dep in deps){
pkg <- paste('package:', dep, sep='')
detach(pkg, character.only = TRUE)
}
setwd(starting_dir)
rm(list=ls())
gc()
